version: '3'
services:
  user_location_service:
    env_file:
      - local.env
    build: user_location_service/
    volumes:
     - ./user_location_service:/code
     - /code/node_modules
    depends_on:
      - user_location_db
  user_location_db:
    image: "redis:alpine"

  user_information_service:
    env_file:
      - local.env
    build: user_information_service/
    volumes:
     - ./user_information_service:/code
     - /code/node_modules
    depends_on:
      - user_information_db
  user_information_db:
    image: "mongo:3.0.14"

  authentication_service:
    env_file:
      - local.env
    build: authentication_service/
    volumes:
     - ./authentication_service:/code
     - /code/node_modules
    depends_on:
      - authentication_db
  authentication_db:
    image: "mongo:3.0.14"

  user_registration_service:
    env_file:
      - local.env
    build: user_registration_service/
    volumes:
     - ./user_registration_service:/code
     - /code/node_modules
    depends_on:
      - authentication_service
      - user_information_service

  proxy:
    build: proxy/
    ports:
     - "8080:8080"
     - "88:88"
    volumes:
     - ./proxy/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg
    depends_on:
      - user_location_service
      - authentication_service
      - user_information_service
      - user_registration_service
